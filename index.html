<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Protoapoclipse FPS</title>
<style>
body { margin:0; overflow:hidden; background:black; touch-action:none; }
canvas { display:block; }
.hud {
position:fixed;
color:white;
font-family:monospace;
font-size:18px;
}
#ammo { bottom:20px; right:20px; }
#health { bottom:20px; left:20px; }
.button {
position:fixed;
width:80px;
height:80px;
border-radius:50%;
background:rgba(255,255,255,0.2);
}
#shootBtn { right:30px; bottom:120px; }
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="health" class="hud">HP: 100</div>
<div id="ammo" class="hud">AMMO: 30</div>
<div id="shootBtn" class="button"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let player = {
x: 200,
y: 200,
angle: 0,
hp: 100,
ammo: 30,
walkSpeed: 120,
runSpeed: 220,
running: false
};

let enemy = {
x: 500,
y: 300,
hp: 100
};

let joystick = { active:false, startX:0, startY:0, dx:0, dy:0 };

let lastTime = 0;
let headBob = 0;
let shooting = false;

function loop(time){
let delta = (time - lastTime)/1000;
lastTime = time;
update(delta);
draw();
requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function update(delta){
let speed = player.running ? player.runSpeed : player.walkSpeed;
let moveX = 0;
let moveY = 0;

if(joystick.active){
let len = Math.hypot(joystick.dx, joystick.dy);
if(len > 10){
let nx = joystick.dx / len;
let ny = joystick.dy / len;

moveX = (Math.cos(player.angle)*-ny + Math.cos(player.angle + Math.PI/2)*nx) * speed * delta;
moveY = (Math.sin(player.angle)*-ny + Math.sin(player.angle + Math.PI/2)*nx) * speed * delta;

headBob += delta * (player.running ? 12 : 6);
}
}

player.x += moveX;
player.y += moveY;

document.getElementById("health").innerText = "HP: " + player.hp;
document.getElementById("ammo").innerText = "AMMO: " + player.ammo;
}

function draw(){
ctx.fillStyle = "#111";
ctx.fillRect(0,0,canvas.width,canvas.height);

// chão
ctx.fillStyle = "#222";
ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

// inimigo simples
let dx = enemy.x - player.x;
let dy = enemy.y - player.y;
let dist = Math.hypot(dx,dy);
let size = 8000 / dist;
ctx.fillStyle = "red";
ctx.fillRect(canvas.width/2 - size/2, canvas.height/2 - size/2, size, size);

// arma melhorada
drawWeapon();
}

function drawWeapon(){
let bob = Math.sin(headBob)*5;
ctx.save();
ctx.translate(canvas.width/2, canvas.height - 150 + bob);

// coronha
ctx.fillStyle="#5a3b2e";
ctx.fillRect(-120,20,80,40);

// corpo principal
ctx.fillStyle="#2f2f2f";
ctx.fillRect(-50,-20,180,60);

// carregador
ctx.fillStyle="#1f1f1f";
ctx.fillRect(10,40,30,60);

// cano
ctx.fillStyle="#444";
ctx.fillRect(120,-10,100,20);

// detalhe superior
ctx.fillStyle="#666";
ctx.fillRect(-30,-30,120,15);

// boca do cano
ctx.fillStyle="#999";
ctx.fillRect(220,-5,15,10);

if(shooting){
ctx.fillStyle="yellow";
ctx.fillRect(240,-15,40,30);
}

ctx.restore();
}

document.getElementById("shootBtn").addEventListener("touchstart",()=>{
if(player.ammo > 0){
player.ammo--;
shooting = true;
setTimeout(()=>shooting=false,100);

let dx = enemy.x - player.x;
let dy = enemy.y - player.y;
if(Math.abs(Math.atan2(dy,dx) - player.angle) < 0.3){
enemy.hp -= 20;
if(enemy.hp <= 0){
enemy.x = Math.random()*1000;
enemy.y = Math.random()*1000;
enemy.hp = 100;
}
}
}
});

// joystick esquerdo
canvas.addEventListener("touchstart",(e)=>{
let t = e.touches[0];
if(t.clientX < canvas.width/2){
joystick.active = true;
joystick.startX = t.clientX;
joystick.startY = t.clientY;
}
});

canvas.addEventListener("touchmove",(e)=>{
for(let t of e.touches){
if(t.clientX < canvas.width/2 && joystick.active){
joystick.dx = t.clientX - joystick.startX;
joystick.dy = t.clientY - joystick.startY;
}
if(t.clientX > canvas.width/2){
player.angle += (t.movementX || 0)*0.01;
}
}
});

canvas.addEventListener("touchend",()=>{
joystick.active = false;
joystick.dx = 0;
joystick.dy = 0;
});

// câmera mouse pc
canvas.addEventListener("mousemove",(e)=>{
if(e.buttons===1){
player.angle += e.movementX*0.003;
}
});
</script>
</body>
</html>
